<% if @user_is_admin == true %>
	<div id="login-box">
		
		<div id="login-form">
		<%= form_tag login_path, remote: true, id: 'login' do %>
			<p>login with your gumroad account</p>
			<%= text_field_tag :email, nil, placeholder: "email", :class => :email %>
			<%= password_field_tag :password, nil, placeholder: "password", :class => :password %>
			<%= submit_tag "login", class: "btn" %>
		<% end %>
		</div>
		<div id="login_spinner"></div>

		<% if @logged_in %>
			<%= link_to "Manage Products", "#", id: "reveal-login", class: "btn", style: "display:none" %>
			<%= link_to 'Logout', logout_path, id: 'logout', class: 'btn', remote: true %>
		<% else %>
			<%= link_to "Manage Products", "#", id: "reveal-login", class: "btn" %>
			<%= link_to 'Logout', logout_path, id: 'logout', class: 'btn', remote: true, style: "display:none" %>
		<% end %>
		
	</div>
<% end %>

<div class="products">
		
		<% if @products.count == 0 && @logged_in == false && @user_is_admin == true %>
			<div class = "step3-help">
				<h1>Boom!</h1>
				<h2>This is your brand spanking new store</h2>
			
				<p>All you need now are products. Click "Manage Products" up the top right and log in with your Gumroad account to start adding items.</p>
			</div>
		<% end %>
		
		
		
		<% if @logged_in %>
			<%= render 'form' %>
		<% end %>

	<div id="first_product"></div>
	
	<% @products.each do |product| %>
 		<%= render 'product', {:product => product, :user_is_admin => @user_is_admin, :logged_in => @logged_in} %>
	<% end %>	
</div>

<script>
$(document).ready(function() {
	$('.tooltip').tooltipster();
	
	if (Modernizr.fileinput && Modernizer.touch) {
		$("#new_product").show();
		$(".file-drop-zone").hide();
	}
	
	
	$('#new_product').bind('fileuploadsubmit', function (e, data) {
		showSpinner($('.file-drop-zone'))
		$('.file-drop-zone').attr('class', 'product-loading')
	})
	
	reloadMasonry()	
	
	$('#login').submit(function(){
		$("#login-form").hide();
		$("#login_spinner").show();
		showSpinner($('#login_spinner'));
	});
	
	$('#logout').click(function(){
		$("#logout").hide();
		$("#login_spinner").show();
		showSpinner($('#login_spinner'));
	});
	
	$('#reveal-login').click(function() {
	  $("#login-form").show("slide", { direction: "right" }, 400);
		$(this).hide();
	});
});

function showSpinner(element) {
	console.log(element)
	console.log('showing spinner')
	$(element).html("<%= escape_javascript(image_tag 'ajax-loader.gif', class: 'spinner' ) %>")
}

function hideProduct(product) {
	$('#'+product).remove();
	reloadMasonry()
}

function reloadMasonry() {
	var $container = $('.products');
	$container.imagesLoaded(function(){
		$container.masonry({
	    // options
			itemSelector: '.product-box',
	    columnWidth : 250,
			isAnimated: true
		});
	});
}

function fileUploadAvailable() {
	var elem = document.createElement('input');
	elem.type = 'file';
	return !elem.disabled;
}

function postProduct(name, description, image, url) {
	FB.ui(
	  {
	    method: 'feed',
	    name: name,
	    link: url,
	    picture: image,
	    caption: name,
	    description: description,
			to: <%= params[:fb_page_id]%>,
			from: <%= params[:fb_page_id] %>
	  },
	  function(response) {
	    if (response && response.post_id) {
	      alert('Post was published.');
	    } else {
	      alert('Post was not published.');
	    }
	  }
	);
	
}


</script>